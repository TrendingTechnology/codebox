<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- development version, includes helpful console warnings -->
    <script src="static/vue-dev.js"></script>
    <title>Hello, world!</title>
    <style type="text/css">
    .func-type {
        white-space: nowrap !important;
        float: none !important;
        display: inline-block !important;
    }

    .selected-inp {
        color: blue;
        font-weight: bold;
    }
    .selected-outp {
        background-color: red;
    }

    input[type=radio] {
        width: 30px;
        height: 30px;
    }

    code {
        white-space: pre-wrap;
        font-size: 12px;
    }
    .com {
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        font-family: Menlo,Monaco,Consolas,"Courier New",monospace;
        font-size: 15px;
        line-height: 1.42857143;
        white-space: pre;
        word-break: normal;
        box-sizing: border-box;
        color: #006600;
    }
    </style>
</head>

<body>
    <div class="container-fluid" id="cb-source">
        <!-- Content here -->
        <h4>Package <b>{{ source.FEName }}</b></h4>
        <div v-for="func in source.Funcs" class="row">
            <div class="col-md-6">
                <div class="col-md-12">
                    <span class="com">
                        <div v-for="comment in func.Docs">// {{ comment }}</div>
                    </span>
                    <div class="alert alert-success" role="alert">
                        <span :id="'func-'+func.Name">
                            func {{ func.Name }}(
                            <div v-for="(input, index) in func.In" :id="'func-'+func.Name+'-in-'+index" class="func-type">
                                {{ input.VarName }} {{ input.IsPtr ? "*" : "" }}<b>{{ input.TypeName }}</b>{{index < func.In.length - 1 ? ", " : "" }} </div> ) ( <div v-for="(output, index) in func.Out" :id="'func-'+func.Name+'-out-'+index" class="func-type">
                                    {{ output.VarName }} {{ output.IsPtr ? "*" : "" }}<b>{{ output.TypeName }}</b>{{index < func.Out.length - 1 ? ", " : "" }} </div> ) 
                        </span>
                    </div>
                    </div>
                        <!--checkboxes for inp -->
                            <div class="col-md-12">
                                        <div v-for="(funIn, index) in func.In" class="func-type">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" :name="'radio-func-'+func.Name+'-inp'" :value="funIn.Placeholder.Val" :parent="'func-'+func.Name" @change="onChangeInp($event, func)" :colorfor="'func-'+func.Name+'-in-'+index">
                                                <label class="form-check-label" :for="'func-'+func.Name+'-in-'+index"></label>
                                            </div>
                                        </div>
                                        <div v-for="(funOut, index) in func.Out" class="func-type">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" :name="'radio-func-'+func.Name+'-inp'" :value="funOut.Placeholder.Val" :parent="'func-'+func.Name" @change="onChangeInp($event, func)" :colorfor="'func-'+func.Name+'-out-'+index">
                                                <label class="form-check-label" :for="'func-'+func.Name+'-out-'+index"></label>
                                            </div>
                                        </div>
                            </div>
                        <!--checkboxes for outp -->
                            <div class="col-md-12">
                                        <div v-for="(funIn, index) in func.In" class="func-type">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" :name="'radio-func-'+func.Name+'-outp'" :value="funIn.Placeholder.Val" :parent="'func-'+func.Name" @change="onChangeOutp($event, func)" :colorfor="'func-'+func.Name+'-in-'+index">
                                                <label class="form-check-label" :for="'func-'+func.Name+'-in-'+index"></label>
                                            </div>
                                        </div>
                                        <div v-for="(funOut, index) in func.Out" class="func-type">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" :name="'radio-func-'+func.Name+'-outp'" :value="funOut.Placeholder.Val" :parent="'func-'+func.Name" @change="onChangeOutp($event, func)" :colorfor="'func-'+func.Name+'-out-'+index">
                                                <label class="form-check-label" :for="'func-'+func.Name+'-out-'+index"></label>
                                            </div>
                                        </div>
                            </div>                            

                </div>

                <div class="col-md-6">
                    <code>
                    class {{ func.FEName }} extends TaintTracking::FunctionModel {
                      {{ func.FEName }}() { hasQualifiedName("{{ source.PkgPath }}", "{{ func.Name }}") }

                      override predicate hasTaintFlow(FunctionInput inp, FunctionOutput outp) {
                        inp.{{ func.CodeQL.Inp }} and outp.{{ func.CodeQL.Outp }}
                      }
                    }
                    </code>
                </div>
            </div>
            <br>
        </div>
        <script type="text/javascript">


 
        var srcapp = new Vue({
            el: '#cb-source',
            data: {
                source: null,
                codeqlInp: null,
                codeqlOutp: null
            },
            mounted() {
                self = this;
                fetch('/api/source')
                    .then(response => response.json())
                    .then(json => {
                        this.source = json;

                        self.codeqlInp ={};
                        self.codeqlOutp={};

                        self.source.Funcs.forEach(function(elem) {
                           self.codeqlInp['func-' +elem.Name] = "a";
                           self.codeqlOutp['func-' +elem.Name] = "a";
                        });
                    })
            },
            methods: {
                getInp(key) {
                    return  this.codeqlInp[key]
                },
                onChangeInp(event, fn) {
                    var radioButton = event.target;

                    var parentID = radioButton.getAttribute("parent");
                    var targetIDInView = radioButton.getAttribute("colorfor");
                    var parent = document.getElementById(parentID);

                    var children = document.querySelectorAll('#' + parentID + ' > .selected-inp')
                    children.forEach(function(elem) {
                        elem.classList.remove("selected-inp");
                    });

                    fn.CodeQL.Inp = radioButton.value

                    console.log(parentID);
                    console.log(radioButton.value);
                    var element = document.getElementById(targetIDInView);
                    element.classList.add("selected-inp");
                } ,
              onChangeOutp(event, fn) {
                    var radioButton = event.target;

                    var parentID = radioButton.getAttribute("parent");
                    var targetIDInView = radioButton.getAttribute("colorfor");
                    var parent = document.getElementById(parentID);

                    var children = document.querySelectorAll('#' + parentID + ' > .selected-outp')
                    children.forEach(function(elem) {
                        elem.classList.remove("selected-outp");
                    });

                    fn.CodeQL.Outp = radioButton.value

                    console.log(parentID);
                    console.log(radioButton.value);
                    var element = document.getElementById(targetIDInView);
                    element.classList.add("selected-outp");
                }
            }
        })
        Vue.component('func-item', {
            props: ['func'],
            template: `
        
        <span v-for="comment in func.Docs">
            // {{ comment }}<br>
        </span>

        `
        })
        </script>
        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</body>

</html>